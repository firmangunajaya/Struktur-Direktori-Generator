<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Struktur Direktori Generator</title>
    <!-- Link Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Link SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.5.0/dist/sweetalert2.min.css" rel="stylesheet">
    <style>
        .button-container {
            display: flex;
            align-items: center;
        }

        #copyFeedback {
            margin-left: 10px;
            display: none;
            color: green;
            font-size: 14px;
        }

        #progressBarContainer {
            width: 100%;
            height: 30px;
            background-color: #f3f3f3;
            border-radius: 5px;
            display: none;
        }

        #progressBar {
            height: 100%;
            width: 0;
            background-color: #4caf50;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-4">Struktur Direktori Generator</h1>

        <!-- Form untuk memilih folder -->
        <form id="folderForm">
            <div class="mb-3">
                <label for="folderPath" class="form-label">Pilih Lokasi Folder</label>
                <input type="file" class="form-control" id="folderPath" webkitdirectory mozdirectory onchange="updateFolderPath()">
            </div>
            <div class="mb-3">
                <label for="folderText" class="form-label">Lokasi Folder yang Dipilih</label>
                <input type="text" class="form-control" id="folderText" readonly>
            </div>
            <!-- Tombol Proses dan Salin dengan pesan di samping kanan tombol Salin -->
            <div class="button-container">
                <button type="button" class="btn btn-primary" onclick="processFolder()">Proses Folder</button>
                <button type="button" class="btn btn-secondary ms-2" id="copyButton" onclick="copyFolderTree()">Salin Struktur Folder</button>
                <div id="copyFeedback">Struktur folder berhasil disalin!</div>
            </div>
        </form>

        <!-- Progress bar -->
        <div id="progressBarContainer">
            <div id="progressBar"></div>
        </div>

        <!-- Div untuk menampilkan folder structure -->
        <div id="folderTree" class="mt-4"></div>
    </div>

    <!-- Link Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"></script>
    <!-- Link SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.5.0/dist/sweetalert2.all.min.js"></script>

    <script>
        // Fungsi untuk memperbarui field text dengan nama folder yang dipilih
        function updateFolderPath() {
            const folderInput = document.getElementById('folderPath');
            const folderText = document.getElementById('folderText');

            if (folderInput.files.length > 0) {
                // Menampilkan nama folder yang dipilih dari path relatif file pertama yang dipilih
                const folderPath = folderInput.files[0].webkitRelativePath.split('/')[0];
                folderText.value = folderPath; // Menampilkan nama folder yang dipilih
            }
        }

        // Fungsi untuk memproses dan menampilkan struktur folder dalam format tree
        function processFolder() {
            const folderInput = document.getElementById('folderPath');
            const folderText = document.getElementById('folderText');
            const folderTreeDiv = document.getElementById('folderTree');
            
            if (folderInput.files.length === 0) {
                alert('Pilih folder terlebih dahulu!');
                return;
            }

            const fileList = folderInput.files;
            const folderStructure = {};

            // Menampilkan progress bar saat memproses folder
            const progressBarContainer = document.getElementById('progressBarContainer');
            const progressBar = document.getElementById('progressBar');
            progressBarContainer.style.display = 'block';

            let width = 0;
            let progressInterval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(progressInterval);
                    // Mengelompokkan file berdasarkan foldernya
                    for (let i = 0; i < fileList.length; i++) {
                        const file = fileList[i];
                        const pathParts = file.webkitRelativePath.split('/');

                        // Ambil nama folder dan file dari path relatif
                        let currentFolder = folderStructure;
                        for (let j = 0; j < pathParts.length - 1; j++) {
                            const folderName = pathParts[j];

                            // Jika folder belum ada, buat folder baru
                            if (!currentFolder[folderName]) {
                                currentFolder[folderName] = {};
                            }
                            currentFolder = currentFolder[folderName];
                        }

                        // Menambahkan file ke dalam folder yang sesuai
                        currentFolder[pathParts[pathParts.length - 1]] = null;
                    }

                    // Menampilkan struktur folder dengan format tree
                    folderTreeDiv.innerHTML = "<pre>" + buildFolderTree(folderStructure) + "</pre>";

                    // Sembunyikan progress bar setelah selesai
                    progressBarContainer.style.display = 'none';
                } else {
                    width += 10;
                    progressBar.style.width = width + '%';
                }
            }, 300); // Update progress every 300ms
        }

        // Fungsi untuk membangun struktur folder dalam format tree
        function buildFolderTree(folderObj, indent = "") {
            let treeOutput = "";
            for (const key in folderObj) {
                if (folderObj.hasOwnProperty(key)) {
                    treeOutput += indent + "├── " + key + "\n";
                    if (typeof folderObj[key] === 'object') {
                        treeOutput += buildFolderTree(folderObj[key], indent + "│   ");
                    }
                }
            }
            return treeOutput;
        }

        // Fungsi untuk menyalin struktur folder ke clipboard
        function copyFolderTree() {
            const folderTreeDiv = document.getElementById('folderTree');
            const copyFeedback = document.getElementById('copyFeedback');
            
            if (folderTreeDiv.innerText.trim() === '') {
                alert('Proses folder terlebih dahulu sebelum menyalin.');
                return;
            }

            // Membuat elemen textarea untuk menyalin teks
            const textarea = document.createElement('textarea');
            textarea.value = folderTreeDiv.innerText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            // Menampilkan pesan SweetAlert dengan tampilan minimalis
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Struktur folder berhasil disalin!',
                showConfirmButton: false,
                timer: 1200,  // Waktu yang lebih singkat
                toast: true,
                position: 'top-end',
                customClass: {
                    popup: 'small-swal'
                }
            });

            // Menampilkan umpan balik bahwa struktur folder berhasil disalin
            copyFeedback.style.display = 'inline'; // Memposisikan feedback di samping kanan tombol Salin
            setTimeout(() => {
                copyFeedback.style.display = 'none';
            }, 2000);
        }
    </script>

    <style>
        /* Menyesuaikan ukuran SweetAlert agar lebih kecil */
        .small-swal {
            font-size: 14px;
            padding: 10px;
            width: 250px;
            height: auto;
        }
    </style>
</body>
</html>
